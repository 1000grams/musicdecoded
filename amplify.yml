version: 1

# 1) Build and deploy your Amplify backend
backend:
  phases:
    preBuild:
      commands:
        # install the Amplify CLI so amplifyPush is available
        - npm install -g @aws-amplify/cli
    build:
      commands:
        # this helper will push your current branch's backend config
        - amplifyPush --simple

# 2) Then build your React front-end
frontend:
  phases:
    preBuild:
      commands:
        - cd decodedmusic-frontend
        - npm ci
    build:
      commands:
        - npm run build
  artifacts:
    # where your React build ends up
    baseDirectory: decodedmusic-frontend/build
    files:
      - '**/*'
  cache:
    paths:
      - decodedmusic-frontend/node_modules/**/*
