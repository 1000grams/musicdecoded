version: 1

backend:
  phases:
    preBuild:
      # install any dependencies needed to run `ampx`
      commands:
        - npm ci --cache .npm --prefer-offline
    build:
      commands:
        - echo "Deploying backend for branch $AWS_BRANCH..."
        - npx ampx pipeline-deploy \
            --app-id $AWS_APP_ID \
            --branch $AWS_BRANCH

frontend:
  phases:
    preBuild:
      # switch into your React app folder
      - cd decodedmusic-frontend
      - npm ci
    build:
      - npm run build
  artifacts:
    # where react-scripts spits out static assets
    baseDirectory: decodedmusic-frontend/build
    files:
      - '**/*'
  cache:
    paths:
      - decodedmusic-frontend/node_modules/**/*
